<article id="<%= post.layout %>-<%= post.slug %>" class="article article-single article-type-<%= post.layout %><%= (post.direction && post.direction.toLowerCase() === 'rtl' ? ' rtl' : '') %>" itemscope itemprop="blogPost">
    <div class="article-inner">
        <% if (post.link || post.title) { %>
            <header class="article-header">
                <%- partial('post/title', { class_name: 'article-title' }) %>
            </header>
        <% } %>
        <% if (post.layout != 'page') { %>
            <div class="article-meta">
                <%- partial('post/date', { class_name: 'article-date', date_format: null }) %>
                <%- partial('post/tag') %>
                阅读数量:<span id="<%= url_for(post.path) %>" class="leancloud_visitors" data-flag-title="<%- post.title %>"></span>次
            </div>
        <% } %>
        <%- partial('post/gallery') %>
        <div class="article-entry" itemprop="articleBody">
            <%- post.content %>
        </div>
        <footer class="article-footer">
            <%- partial('share/index', { post: post }) %>
            <script src="//cdn1.lncld.net/static/js/2.5.0/av-min.js"></script>
                <script>
                    var APP_ID = '2QuAtxUrsXKv0Ebn0aR4mUPV-gzGzoHsz';
                    var APP_KEY = 'd5ELeHy0cygskACy3uFdL9Vh';
                    AV.init({
                        appId: APP_ID,
                        appKey: APP_KEY
                    });
                    // 显示次数
                    function showTime(Counter) {
                        var query = new AV.Query("Counter");
                        if($(".leancloud_visitors").length > 0){
                            var url = $(".leancloud_visitors").attr('id').trim();
                            // where field
                            query.equalTo("words", url);
                            // count
                            query.count().then(function (number) {
                                // There are number instances of MyClass where words equals url.
                                $(document.getElementById(url)).text(number?  number : '--');
                            }, function (error) {
                                // error is an instance of AVError.
                            });
                        }
                    }
                    // 追加pv
                    function addCount(Counter) {
                        var url = $(".leancloud_visitors").length > 0 ? $(".leancloud_visitors").attr('id').trim() : 'icafebolger.com';
                        var Counter = AV.Object.extend("Counter");
                        var query = new Counter;
                        query.save({
                            words: url
                        }).then(function (object) {
                        })
                    }
                    $(function () {
                        var Counter = AV.Object.extend("Counter");
                        addCount(Counter);
                        showTime(Counter);
                    });
                </script>
        </footer>
    </div>
</article>
<%- partial('comment/livebe') %>